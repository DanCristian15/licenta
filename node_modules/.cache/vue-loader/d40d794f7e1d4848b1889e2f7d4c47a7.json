{"remainingRequest":"/Users/cristiandan/Desktop/proiect-licenta-front/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/cristiandan/Desktop/proiect-licenta-front/src/core/views/event/TheEvent.vue?vue&type=style&index=0&id=73ebfc74&scoped=true&lang=scss&","dependencies":[{"path":"/Users/cristiandan/Desktop/proiect-licenta-front/src/core/views/event/TheEvent.vue","mtime":1645805364021},{"path":"/Users/cristiandan/Desktop/proiect-licenta-front/node_modules/css-loader/dist/cjs.js","mtime":1637061260154},{"path":"/Users/cristiandan/Desktop/proiect-licenta-front/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1637061260528},{"path":"/Users/cristiandan/Desktop/proiect-licenta-front/node_modules/postcss-loader/src/index.js","mtime":1637061260465},{"path":"/Users/cristiandan/Desktop/proiect-licenta-front/node_modules/sass-loader/dist/cjs.js","mtime":1637061279772},{"path":"/Users/cristiandan/Desktop/proiect-licenta-front/node_modules/cache-loader/dist/cjs.js","mtime":1637061222564},{"path":"/Users/cristiandan/Desktop/proiect-licenta-front/node_modules/vue-loader/lib/index.js","mtime":1637061260528}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCkBpbXBvcnQgIkBzY3NzVmFyaWFibGVzIjsKQGltcG9ydCAiQHNjc3NNaXhpbnMiOwoKJGdzdEV2ZW50U3RhcnRQb3NpdGlvbjogNjBweDsKCi5nc3QtZXZlbnQgewogICAgaGVpZ2h0OiBjYWxjKCAxMDB2aCAtIDYwcHggKTsKfQoKLmdzdC1ldmVudF9fZmlsdGVyIHsKICAgIHBhZGRpbmctdG9wOiAxMnB4OwogICAgei1pbmRleDogMTsKCiAgICBAaW5jbHVkZSBtb2JpbGUtb25seSB7CiAgICAgICAgcGFkZGluZy10b3A6IDE2cHg7CiAgICB9Cn0K"},{"version":3,"sources":["TheEvent.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0qBA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"TheEvent.vue","sourceRoot":"src/core/views/event","sourcesContent":["<template>\n    <v-flex class=\"gst-event\"\n        :class=\"{'gst-event-mobile': !$vuetify.breakpoint.mdAndUp}\">\n        <EventHeader />\n        <DataLoading v-if=\"loading\" class=\"mt-5 mb-5 pt-5 pb-5\" />\n        <v-flex v-else d-flex flex-column class=\"u-height-100\">\n            <EventBanner :item=\"event\" />\n            <EventVenueImage :loading-tickets=\"loadingTickets\" :tickets=\"tickets\" :venue-details=\"venueDetails\" />\n            <EventTicketFilter v-model=\"filter\" :options=\"filterOptions.current\" :disabled=\"isEventTicketsNotAvailable\" class=\"gst-event__filter\" @reset=\"resetFilter\" />\n            <div :style=\"{'flex': 1, display: 'flex', 'min-height':0}\">\n                <v-flex d-flex xs12 md4 :style=\"{flex: 1}\" class=\"u-position-relative\">\n                    <EventAttractionList v-if=\"isEventTicketsNotAvailable\" :event=\"event\" />\n                    <EventTicketList\n                        v-else\n                        :event=\"event\"\n                        :tickets=\"tickets\"\n                        :total-tickets=\"totalTickets\"\n                        :tickets-with-offers=\"ticketsWithOffers\"\n                        :loading-tickets=\"loadingTickets\"\n                        :selected-ticket=\"selectedTicket\"\n                        :selected-ticket-detail-info=\"selectedTicketDetailInfo\"\n                        :sort=\"sort\"\n                        :show-tickets-few-available-warning=\"showEventTicketsStatusFewAvailableWarning\"\n                        :bus-event-parent=\"busEvent\"\n                        @hightlight-ticket=\"setHighlightedTicket\"\n                        @click-item=\"openEventTicketDetail\"\n                        @load-more=\"loadTicketsDebounced\"\n                        @close-ticket=\"selectedTicket = null\"\n                        @open-filter-modal=\"openTicketFilterModal\"\n                        @close-tickets-few-available-warning=\"showEventTicketsStatusFewAvailableWarning=false\" />\n                </v-flex>\n                <v-flex v-if=\"$vuetify.breakpoint.mdAndUp\" md8 :style=\"{flex: 1}\">\n                    <EventTicketImage\n                        :loading-tickets=\"loadingTickets\"\n                        :tickets=\"tickets\"\n                        :venue-details=\"venueDetails\"\n                        :venue-seat-map-url=\"venueSeatMapUrl\"\n                        :show-tickets-few-available-warning=\"showEventTicketsStatusFewAvailableWarning\"\n                        @close-tickets-few-available-warning=\"showEventTicketsStatusFewAvailableWarning=false\" />\n                </v-flex>\n            </div>\n            <EventTicketMaintenanceOverlay v-if=\"!loading && isEventTicketsMaintenance\" />\n            <EventSimilarAttractions />\n        </v-flex>\n        <router-view />\n    </v-flex>\n</template>\n\n<script>\n    import Vue from 'vue';\n    import debounce from 'lodash/debounce';\n    import isEqual from 'lodash/isEqual';\n    import cloneDeep from 'lodash/cloneDeep';\n    import { mapActions, mapGetters, mapState } from 'vuex';\n    import ticketsConstants from '@core/utils/constants/ticket';\n    import entityConstants from '@core/utils/constants/entity';\n    import imageConstants from '@core/utils/constants/imagePaths';\n    import searchConstants from '@core/utils/constants/search';\n    import eventConstants from '@core/utils/constants/event';\n    import apiConstants from '@core/utils/constants/api';\n    import listConstants from '@core/utils/constants/list';\n    import {\n        isAfter as dateUtilsIsAfter,\n        differenceInSeconds as dateUtilsDifferenceInSeconds\n    } from '@core/utils/dateUtils';\n    import {\n        hasTicketAvailable as eventUtilsHasTicketAvailable\n    } from '@core/utils/eventUtils';\n    import { sortCompare } from '@core/utils/sortCompareUtils';\n    import ticketsStoreModule from '@core/store/modules/tickets';\n    import DataLoading from '@core/shared/components/loading/DataLoading.vue';\n    import EntityNotFoundRedirect404 from '@core/mixins/EntityNotFoundRedirect404';\n    import WarnBeforeLeave from '@core/mixins/WarnBeforeLeave';\n    import DynamicStoreModule from '@/core/mixins/DynamicStoreModule';\n    import ApiCancelService from '@services/ApiCancelService';\n    import { EventTicketDetailModal,\n             EventTicketFilter,\n             EventTicketFilterModal,\n             EventTicketMaintenanceOverlay,\n             EventBanner,\n             EventHeader,\n             EventVenueImage,\n             EventTicketImage,\n             EventTicketList,\n             EventAttractionList,\n             EventSimilarAttractions } from './TheEvent/index';\n    import { HealthCheckConfirmationModalDesktop, HealthCheckConfirmationModalMobile } from './TheEvent/HealthCheckConfirmationModal';\n\n    const STORE_NAME = 'events';\n    const CONFIG_TICKETS = {\n        LIMIT: searchConstants.DEFAULT.LIMIT,\n        FILTER_DEFAULT: {\n            QUANTITY: 2,\n            MIN_QUANTITY: 1,\n            MAX_QUANTITY: 50,\n            PRICE: {\n                MIN: 0,\n                MAX: 5000,\n                CURRENCY: ''\n            },\n            ACCESSIBILITY: false,\n        }\n    };\n\n    export default {\n        name: 'TheEvent',\n        components: {\n            DataLoading,\n            EventTicketMaintenanceOverlay,\n            EventTicketFilter,\n            EventTicketList,\n            EventBanner,\n            EventHeader,\n            EventVenueImage,\n            EventTicketImage,\n            EventAttractionList,\n            EventSimilarAttractions,\n            // eslint-disable-next-line vue/no-unused-components\n            HealthCheckConfirmationModalDesktop,\n            // eslint-disable-next-line vue/no-unused-components\n            HealthCheckConfirmationModalMobile\n        },\n        i18nOptions: {\n            namespaces: 'main',\n            keyPrefix: 'views.event.theEvent'\n        },\n        testIdOptions: {\n            keyPrefix: 'event'\n        },\n        mixins: [\n            EntityNotFoundRedirect404,\n            WarnBeforeLeave,\n            DynamicStoreModule\n        ],\n        data( ) {\n            const defaultSort = { value: 'price', 'display': this.$t( '_common:terms.price' ) };\n\n            return {\n                loading: true,\n                tickets: [ ],\n                totalTickets: 0,\n                offersMap: { },\n                ticketTypesMap: { },\n                venueDetails: {\n                    mapUrl: '',\n                    mapWithlabelsUrl: ''\n                },\n                event: { },\n                highlightedTicket: null,\n                selectedTicket: null,\n                showTicketDetail: false,\n                sort: {\n                    value: defaultSort,\n                    options: [\n                        defaultSort,\n                        { value: 'quality', 'display': this.$t( '_common:terms.quality' ) },\n                    ]\n                },\n                filter: {\n                    quantity: CONFIG_TICKETS.FILTER_DEFAULT.QUANTITY,\n                    price: {\n                        range: [ CONFIG_TICKETS.FILTER_DEFAULT.PRICE.MIN, CONFIG_TICKETS.FILTER_DEFAULT.PRICE.MAX ],\n                        min: CONFIG_TICKETS.FILTER_DEFAULT.PRICE.MIN,\n                        max: CONFIG_TICKETS.FILTER_DEFAULT.PRICE.MAX,\n                        currency: CONFIG_TICKETS.FILTER_DEFAULT.PRICE.QUANTITY\n                    },\n                    accessibility: CONFIG_TICKETS.FILTER_DEFAULT.ACCESSIBILITY\n                },\n                filterOptions: {\n                    current: {\n                        accessibilityEnabled: false,\n                        minQuantity: CONFIG_TICKETS.FILTER_DEFAULT.MIN_QUANTITY,\n                        maxQuantity: CONFIG_TICKETS.FILTER_DEFAULT.MAX_QUANTITY\n                    },\n                    noAccesability: {\n                        minQuantity: CONFIG_TICKETS.FILTER_DEFAULT.MIN_QUANTITY,\n                        maxQuantity: CONFIG_TICKETS.FILTER_DEFAULT.MAX_QUANTITY\n                    },\n                    accessibility: {\n                        minQuantity: CONFIG_TICKETS.FILTER_DEFAULT.MIN_QUANTITY,\n                        maxQuantity: CONFIG_TICKETS.FILTER_DEFAULT.MAX_QUANTITY,\n                        companionMinQuantity: CONFIG_TICKETS.FILTER_DEFAULT.MIN_QUANTITY,\n                        companionMaxQuantity: CONFIG_TICKETS.FILTER_DEFAULT.MAX_QUANTITY\n                    }\n                },\n                busEvent: new Vue( ),\n                loadingTickets: false,\n                isEventTicketsMaintenance: false,\n                showEventTicketsStatusFewAvailableWarning: false,\n                userAnalytics: false,\n                lastAppliedFilter: { },\n                previousRoute: { },\n            };\n        },\n        computed: {\n            ...mapState( {\n                item:                   state => state[STORE_NAME].detail,\n            } ),\n            ...mapGetters( {\n                isLoyaltyCurrencyTypeMoney: 'appTenant/isLoyaltyCurrencyTypeMoney'\n            } ),\n            itemId( ) {\n                return this.$route.params.id;\n            },\n            venueSeatMapUrl( ) {\n                if ( this.selectedTicket ) {\n                    return this.selectedTicket.venueSeatMapUrl;\n                }\n                if ( this.highlightedTicket ) {\n                    return this.highlightedTicket.venueSeatMapUrl;\n                }\n                return null;\n            },\n            noTickets() {\n                return imageConstants.FALLBACKS.NO_TICKETS;\n            },\n            selectedTicketDetailInfo( ) {\n                return this.selectedTicket ?  this.getTicketDetailInfo( this.selectedTicket ) : null;\n            },\n            isMaxQuantityAvailable( ) {\n                return this.filterOptions.current.maxQuantity >= CONFIG_TICKETS.FILTER_DEFAULT.MAX_QUANTITY;\n            },\n            isEventTicketsStatusFewAvailable( ) {\n                return this.event.ticketsStatus === eventConstants.TICKETS_STATUS.FEW_AVAILABLE;\n            },\n            isEventTicketsNotAvailable( ) {\n                return !eventUtilsHasTicketAvailable( this.event );\n            },\n            ticketsWithOffers( ) {\n                return this.tickets.filter( ticket => ticket.offers.length );\n            },\n            hasHealthCheck( ) {\n                return !!this.event.healthCheck;\n            },\n            needToShowConfirmationHealtCheck( ) {\n                return this.hasHealthCheck && ( !this.previousRoute || this.previousRoute.name !== 'cartCheckout' );\n            }\n        },\n        watch: {\n            '$route.params.id': function( ) {\n                this.loadData( );\n            },\n            'sort.value': function ( ) {\n                this.loadTickets( true );\n            }\n        },\n        methods: {\n            ...mapActions( {\n                loadOne                         : `${STORE_NAME}/one`,\n                loadEventTicketsAvailability    : `tickets/availability`,\n                loadEventTickets                : 'tickets/get',\n                addEntityToUserBrowsingHistory  : 'user/browsingHistory/addEntity',\n                showLoadingOverlay              : 'appState/setLoading',\n                addItemToCart                   : 'cart/addItem',\n                instantDeleteCurrentCart        : 'cart/instantDeleteCurrentCart'\n            } ),\n            async loadData( ) {\n                this.loading = true;\n                const event = await this.loadEvent( );\n\n                if ( event ) {\n                    if ( !this.isEventTicketsNotAvailable ) {\n                        this.loading = false;\n\n                        !this.needToShowConfirmationHealtCheck || this.openHealthCheckConfirmationModal( );\n                        if ( this.isEventTicketsStatusFewAvailable ) {\n                            this.showEventTicketsStatusFewAvailableWarning = true;\n                            this.filter.quantity = 1;\n                        }\n\n\n                        const responseTickets = await this.loadTickets( true );\n\n                        if ( responseTickets && responseTickets.success ) {\n                            await this.loadTicketsAvailability( );\n                        }\n\n                        this.addFilterWatchers( );\n                    } else {\n                        this.deferReloadFutureOnSaleDate( );\n                        this.loading = false;\n                    }\n                }\n            },\n            async loadEvent( ) {\n                const responseEvent = await this.loadOne( this.itemId );\n                const getMaxPrice = ( maxPrice ) => {\n                    const ret = parseFloat( maxPrice );\n\n                    return ret === Math.floor( ret ) ? ret : Math.floor( ret ) + 1;\n                };\n\n                if ( !responseEvent ) {\n                    this._goToNotFoundPage( );\n                    return;\n                }\n\n                this.event = responseEvent;\n                this.filter.price.min = 0;\n                this.filter.price.max = this.event.maxPrice ? getMaxPrice( this.event.maxPrice ) : 0;\n                this.filter.price.range = [ this.filter.price.min, this.filter.price.max ];\n                this.filter.price.currency = this.event.currency;\n                this.addEntityToUserBrowsingHistory( { entityType: entityConstants.TYPES.EVENT, data: this.item } );\n\n                return this.event;\n            },\n            async loadTicketsAvailability( ) {\n                const response = await this.loadEventTicketsAvailability( { eventId: this.itemId } );\n\n                if ( response.success ) {\n                    if ( response.data && response.data.accessibility ) {\n                        const { accessibility } = response.data;\n\n                        this.filterOptions.current.accessibilityEnabled         = accessibility.enabled;\n                        this.filterOptions.accessibility.minQuantity            = accessibility.minLimit;\n                        this.filterOptions.accessibility.maxQuantity            = accessibility.maxLimit;\n                        this.filterOptions.accessibility.companionMinQuantity   = accessibility.companionMinLimit;\n                        this.filterOptions.accessibility.companionMaxQuantity   = accessibility.companionMaxLimit;\n                    }\n                }\n            },\n            async loadTickets( refresh = false ) {\n                const clearData = ( ) => {\n                    this.tickets = [];\n                    this.offersMap = {};\n                    this.ticketTypesMap = {};\n                    this.highlightedTicket = null;\n                    this.selectedTicket = null;\n                };\n\n                const getSearchParams = ( ) => {\n                    const { price, accessibility, quantity } = this.filter;\n                    const ret = {\n                        offset: refresh ? 0 : this.tickets.length,\n                        limit: CONFIG_TICKETS.LIMIT,\n                        sort: this.sort.value.value,\n                        quantity,\n                    };\n\n                    if ( price.range[0] > price.min || price.range[1] < price.max ) {\n                        ret.priceRange = price.range;\n                    }\n                    if ( accessibility ) {\n                        ret.accessibility = accessibility;\n                    }\n\n                    return ret;\n                };\n                const updateDataFromResponse = ( responseTickets, accessibility ) => {\n                    const updateFilterPriceRangeFromTicketOffers = ( offers ) => {\n                        const getNewMaxPriceFromOffers = ( ) => {\n                            return offers.reduce( ( maxPrice, item ) => {\n                                let basePrice = parseFloat( item.basePrice );\n\n                                basePrice = basePrice === Math.floor( basePrice ) ? basePrice : Math.floor( basePrice ) + 1;\n\n                                return basePrice > maxPrice ? basePrice : maxPrice;\n\n                            }, this.filter.price.max );\n                        };\n                        const maxPrice = getNewMaxPriceFromOffers( );\n                        if ( maxPrice > this.filter.price.max ) {\n                            if ( this.filter.price.max === this.filter.price.range[ 1 ] ) {\n                                this.removeFilterWatchers( );\n                                this.filter.price.range = [ this.filter.price.range[ 0 ], maxPrice ];\n                                this.addFilterWatchers( );\n                            }\n                            this.filter.price.max = maxPrice;\n                        }\n                    };\n                    const updateFilterQuantityRangeNoAccesibilityFromTicketOffers = ( offers ) => {\n                        const getNewMaxQuantityFromOffers = ( ) => {\n                            return offers.reduce( ( max, item ) => {\n                                let maxLimit = parseFloat( item.limitMax );\n\n                                return maxLimit > max ? maxLimit : max;\n\n                            }, this.filterOptions.noAccesability.maxQuantity );\n                        };\n\n                        const maxQuantity = getNewMaxQuantityFromOffers( );\n                        if ( maxQuantity > this.filterOptions.noAccesability.maxQuantity ) {\n                            this.filterOptions.noAccesability.maxQuantity = maxQuantity;\n                            this.filterOptions.current.maxQuantity = maxQuantity;\n                        }\n                    };\n\n                    this.ticketTypesMap = {\n                        ...this.ticketTypesMap,\n                        ...( responseTickets.ticketTypes.reduce( ( acc, item ) => {\n                            acc[ item.id ] = item;\n\n                            return acc;\n                        }, { } ) )\n                    };\n\n                    this.offersMap = {\n                        ...this.offersMap,\n                        ...( responseTickets.offers.reduce( ( acc, { pointsEarned, ...rest } ) => {\n                            acc[rest.id] = {\n                                ...rest,\n                                bonusPoints: pointsEarned || 0,\n                                ticketType: rest.id ? this.ticketTypesMap[ rest.id ] : null\n                            };\n\n                            return acc;\n                        }, { } ) )\n                    };\n\n\n                    const normalizeTicketItem = ( item ) => {\n                        const ticket = {\n                            ...item,\n                            offersIds: item.offers,\n                            offers: item.offers\n                                .map( offerId => {\n                                    const offer = this.offersMap[ offerId ];\n\n                                    if ( !offer ) {\n                                        return;\n                                    }\n\n                                    return {\n                                        ...offer,\n                                        ticketType: this.ticketTypesMap[ offer.ticketTypeId ]\n                                    };\n                                } )\n                                .filter( offer => offer )\n                        };\n\n                        if ( item.selection === ticketsConstants.TYPES.RESALE ) {\n                            ticket.offers.sort( ( a, b ) => sortCompare( a.basePrice, b.basePrice ) );\n                        }\n                        return ticket;\n                    };\n\n                    this.tickets = [\n                        ...this.tickets,\n                        ...( responseTickets.tickets.items.map ( normalizeTicketItem ) )\n                    ];\n\n                    this.totalTickets = responseTickets.tickets.totalCount;\n\n                    updateFilterPriceRangeFromTicketOffers( responseTickets.offers );\n                    accessibility || updateFilterQuantityRangeNoAccesibilityFromTicketOffers( responseTickets.offers );\n                    if ( !this.venueDetails.mapUrl ) {\n                        Vue.set( this.venueDetails, 'mapUrl', responseTickets.eventDetails.venueMapUrl );\n                        Vue.set( this.venueDetails, 'mapWithlabelsUrl', responseTickets.eventDetails.venueMapWithLabelsUrl );\n                    }\n                };\n\n                if ( isEqual ( this.lastAppliedFilter, { ...this.filter, sort: this.sort.value.value } ) && refresh ) {\n                    return;\n                }\n\n                this.loadingTickets = true;\n                !refresh || clearData( );\n\n                this.lastAppliedFilter = cloneDeep( { ...this.filter, sort: this.sort.value.value } );\n\n                const accessibility = this.filter.accessibility;\n                const responseTickets = await this.loadEventTickets( {\n                    eventId: this.itemId,\n                    refresh,\n                    search: getSearchParams( ),\n                    userAnalytics: this.userAnalytics\n                }, );\n\n                if ( responseTickets.success ) {\n                    if ( refresh ) {\n                        clearData();\n                    }\n\n                    updateDataFromResponse ( responseTickets.data, accessibility );\n                } else {\n                    if ( responseTickets.code && responseTickets.code === apiConstants.ERROR_CODES.EVENT_PROVIDER.SYSTEM_DOWN ) {\n                        this.isEventTicketsMaintenance = true;\n                    }\n                }\n\n                this.loadingTickets = responseTickets.cancel ? this.loadingTickets : false;\n                this.userAnalytics = true;\n\n                return responseTickets;\n            },\n            loadTicketsDebounced: debounce( function( refresh = false ) {\n                this.loadTickets( refresh );\n            }, listConstants.DEBOUNCE_DELAY ),\n            getTicketDetailInfo( ticket ) {\n                return {\n                    ticket: ticket,\n                    offers: ticket.offers,\n                    event: this.event,\n                    quantity: this.filter.quantity,\n                };\n            },\n            openEventTicketDetail( ticket ) {\n                this.selectedTicket = ticket;\n\n                if ( !this.$vuetify.breakpoint.mdAndUp ) {\n                    const propsMobile = {\n                        'content-class': 'v-dialog__height-98',\n                        scrollable: true,\n                        fullscreen: false,\n                        'hide-overlay': false,\n                        transition: 'dialog-bottom-transition'\n                    };\n\n                    this.$modal.showBottom(\n                        EventTicketDetailModal,\n                        {\n                            ...this.getTicketDetailInfo( ticket ),\n                            busEventParent: this.busEvent\n                        },\n                        propsMobile,\n                        {\n                            beforeClose: ( ) => {\n                                this.selectedTicket = null;\n                            }\n                        }\n                    );\n                }\n            },\n            setHighlightedTicket( ticket ) {\n                this.highlightedTicket = ticket;\n            },\n            openTicketFilterModal( ) {\n                this.$modal.showBottom(\n                    EventTicketFilterModal,\n                    {\n                        filter: this.filter,\n                        options: this.filterOptions.current,\n                        busEventParent: this.busEvent\n                    },\n                    {\n                        scrollable: false,\n                        fullscreen: false,\n                        'hide-overlay': false,\n                        transition: 'dialog-bottom-transition'\n                    }\n                );\n            },\n            openHealthCheckConfirmationModal( ) {\n                const { healthCheck } = this.event;\n                const propsMobile = {\n                    'content-class': 'gst-v-dialog',\n                    scrollable: true,\n                    fullscreen: false,\n                    'hide-overlay': false,\n                    persistent: true,\n                    transition: 'dialog-bottom-transition'\n                };\n                const propsDesktop = {\n                    'no-click-animation': true,\n                    scrollable: true,\n                    fullscreen: false,\n                    persistent: true,\n                    'hide-overlay': false,\n                    'max-width': 500,\n                    'content-class': 'gst-v-dialog',\n                };\n\n                if ( this.$vuetify.breakpoint.mdAndUp  ){\n                    this.$modal.show(\n                        HealthCheckConfirmationModalDesktop,\n                        { healthCheck },\n                        propsDesktop\n                    );\n                } else {\n                    this.$modal.showBottom(\n                        HealthCheckConfirmationModalMobile,\n                        { healthCheck },\n                        propsMobile\n                    );\n                }\n            },\n            updateFilter( filter ) {\n                this.filter = filter;\n            },\n            resetFilter( ) {\n                this.filter.quantity = CONFIG_TICKETS.FILTER_DEFAULT.QUANTITY;\n                this.filter.price.range = [ this.filter.price.min, this.filter.price.max ];\n                this.filter.accessibility = CONFIG_TICKETS.FILTER_DEFAULT.ACCESSIBILITY;\n            },\n            removeFilterWatchers( ) {\n                !this._watchFilterQuantity || this._watchFilterQuantity( );\n                !this._watchFilterPriceRange ||  this._watchFilterPriceRange( );\n                !this._watchFilterAccessibility || this._watchFilterAccessibility( );\n            },\n            addFilterWatchers( ) {\n                const addForQuantity = ( ) => {\n                    !this._watchFilterQuantity || this._watchFilterQuantity( );\n                    this._watchFilterQuantity = this.$watch( 'filter.quantity', ( ) => {\n                        this.loadTicketsDebounced( true );\n                    } );\n                };\n\n                const addForPriceRange = ( ) => {\n                    !this._watchFilterPriceRange ||  this._watchFilterPriceRange( );\n                    this._watchFilterPriceRange = this.$watch( 'filter.price.range', ( newValue, oldValue ) => {\n                        if ( newValue[ 0 ] !== oldValue[ 0 ] || newValue[ 1 ] !== oldValue[ 1 ] ) {\n                            this.loadTickets( true );\n                        }\n                    } );\n                };\n                const addForAccessibility = ( ) => {\n                    !this._watchFilterAccessibility || this._watchFilterAccessibility( );\n                    this._watchFilterAccessibility = this.$watch( 'filter.accessibility', ( value ) => {\n                        const { current, accessibility, noAccesability } = this.filterOptions;\n                        const { quantity } = this.filter;\n\n                        if ( value ) {\n                            this.filterOptions.current.minQuantity = accessibility.minQuantity;\n                            this.filterOptions.current.maxQuantity = accessibility.maxQuantity;\n                        } else {\n                            this.filterOptions.current.minQuantity = noAccesability.minQuantity;\n                            this.filterOptions.current.maxQuantity = noAccesability.maxQuantity;\n                        }\n                        if ( quantity >= current.minQuantity && quantity <=current.maxQuantity ) {\n                            this.loadTicketsDebounced( true );\n                        } else {\n                            this.filter.quantity = CONFIG_TICKETS.FILTER_DEFAULT.QUANTITY <= current.maxQuantity ? Math.max( current.minQuantity, CONFIG_TICKETS.FILTER_DEFAULT.QUANTITY ) : current.minQuantity;\n                        }\n                    } );\n                };\n\n                addForQuantity( );\n                addForPriceRange( );\n                addForAccessibility( );\n            },\n            deferReloadFutureOnSaleDate( ) {\n                const now = new Date( );\n                const { onSaleStartDateTimeAt } = this.event;\n\n                if ( onSaleStartDateTimeAt && dateUtilsIsAfter( onSaleStartDateTimeAt, now ) ) {\n                    const delay = Math.min( ( dateUtilsDifferenceInSeconds( onSaleStartDateTimeAt, now ) * 1000 ), ( Math.pow( 2, 31 ) - 1 ) );\n\n                    this.deferReload = setTimeout(\n                        ( ) => {\n                            this.loadData( );\n                        },\n                        delay\n                    );\n                }\n            },\n            async checkout( payload ) {\n                this.$router.push( { name: 'event.reservation', params: { payload: payload } } );\n            }\n        },\n        async mounted( ) {\n            await this.loadData( );\n        },\n        created( ) {\n            this.registerStoreModule( 'tickets', ticketsStoreModule );\n\n            this.busEvent.$on( 'reset-filter', this.resetFilter );\n            this.busEvent.$on( 'update-filter', this.updateFilter );\n            this.busEvent.$on( 'checkout', this.checkout );\n        },\n        destroyed( ) {\n            this.busEvent.$off( 'reset-filter' );\n            this.busEvent.$off( 'update-filter' );\n            this.busEvent.$off( 'checkout' );\n\n            ApiCancelService.clear( 'events.one' );\n            ApiCancelService.clear( 'tickets.get' );\n            ApiCancelService.clear( 'tickets.availability' );\n\n            this._destroyed = true;\n        },\n        beforeRouteEnter( to, from, next ) {\n            next( ( cmp ) => {\n                cmp.previousRoute = from;\n            } );\n        },\n        beforeRouteUpdate( to, from, next ) {\n            this.previousRoute = from;\n            next( );\n        },\n    };\n</script>\n<style scoped lang=\"scss\">\n    @import \"@scssVariables\";\n    @import \"@scssMixins\";\n\n    $gstEventStartPosition: 60px;\n\n    .gst-event {\n        height: calc( 100vh - 60px );\n    }\n\n    .gst-event__filter {\n        padding-top: 12px;\n        z-index: 1;\n\n        @include mobile-only {\n            padding-top: 16px;\n        }\n    }\n</style>"]}]}